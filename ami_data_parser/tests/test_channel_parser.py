from unittest import TestCase
from ami_data_parser.parser.channel_parser import ChannelParser


class ChannelParserTestCase(TestCase):

    def test_get_data(self):
        received_data = ['Response: Success\r\n', 'ActionID: tatianno-ThinkPad-L470-00000001\r\n', 'Message: Command output follows\r\n', 'Output: SIP/IP-7436-QPQGE-00000002!C_1_ENT!997799298!1!Down!AppDial!(Outgoing Line)!997799298!3!3!3!2!!1740760337.2\r\n', 'Output: SIP/IP-101-Q14V2-00000001!macro-externa!s!22!Ring!Dial!SIP/IP-7436-QPQGE/997799298,90,TtM(saida_atendimento)!101!3!!3!2!!1740760337.1\r\n']
        expected_data = [
            {
                'channel': 'SIP/IP-7436-QPQGE-00000002',
                'context': 'C_1_ENT',
                'exten': '997799298',
                'priority': '1',
                'state': 'Down',
                'application': 'AppDial',
                'app_data': '(Outgoing Line)',
                'callerid_num': '997799298',
                'uniqueid': '1740760337.2'
            },
            {
                'channel': 'SIP/IP-101-Q14V2-00000001',
                'context': 'macro-externa',
                'exten': 's',
                'priority': '22',
                'state': 'Ring',
                'application': 'Dial',
                'app_data': 'SIP/IP-7436-QPQGE/997799298,90,TtM(saida_atendimento)',
                'callerid_num': '101',
                'uniqueid': '1740760337.1'
            }
        ]
        parser = ChannelParser()
        data = parser.get_data(received_data)
        self.assertListEqual(data, expected_data)
    
    def test_get_data_without_output_word(self):
        received_data = ['Response: Follows\r\n', 'Privilege: Command\r\n', 'ActionID: pbx-jhf-0000002a\r\n', 'SIP/551120872200-00085b93!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!77988367483!2!!3!1872!!1744054071.1123499\n', 'SIP/262-IPJM3GO-00085c40!macro-externa!s!22!Up!Dial!SIP/20872200/015981305687,90,TtM(saida_atendimento)!262!3!3!3!1750!6c1e181f-2532-4803-8aca-d7492477d372!1744054193.1123750\n', 'SIP/20872200-0006b82e!macro-externa!s!1!Up!AppDial!(Outgoing Line)!071991869910!3!3!3!1145449!4e843037-768d-4509-8115-86e617cdf1a4!1742910494.916555\n', 'SIP/551120872200-00086494!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!17996724635!1!!3!252!fafc1c66-83bd-4af0-a14e-35c06098cad6!1744055691.1128248\n', 'SIP/551120872200-000864e5!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!75998589575!1!!3!170!b28f4938-c3a0-4741-a13d-20027a7f301b!1744055773.1128431\n', 'Local/11992570001@C_2_SAIDA-00006334;1!C_2_SAIDA!!1!Up!AppDial!(Outgoing Line)!388!2!2!3!1145590!9aca9798-df9e-44b3-9302-eecd0203e08e!1742910352.916490\n', 'Local/11992570001@C_2_SAIDA-00006334;2!macro-externa!s!22!Up!Dial!SIP/20872200/992570001,90,TtM(saida_atendimento)!388!1!2!3!1145590!5074d955-3a61-47a6-b056-264cbb0b70c2!1742910352.916491\n', 'SIP/136-IP8IaBB-000862f8!CONTEXT_2!Menu1_op1!1!Up!AppQueue!(Outgoing Line)!136!!1!3!496!56b9788e-f0ed-48e2-b2da-d3ebffc62fd3!1744055447.1127504\n', 'SIP/551120872200-000864df!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!71996233050!1!!3!189!!1744055753.1128403\n', 'SIP/551120872200-00086527!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!16988115021!1!!3!102!!1744055841.1128503\n', 'SIP/551120872200-0006b7af!macro-interno!s!30!Up!Dial!SIP/158,25,TtM(ramal_atendimento)!88993826922!2!2!3!1145945!0741df32-0193-4d1a-b262-6477c601ea17!1742909998.916169\n', 'SIP/20872200-0006f055!macro-externa!s!1!Up!AppDial!(Outgoing Line)!071987201018!3!3!3!1045235!73272644-562e-4f30-b0c6-d6f6bc15321f!1743010707.944759\n', 'SIP/551120872200-00085cc2!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!69999771487!2!!3!1663!!1744054279.1123989\n', 'SIP/20872200-0008630c!macro-externa!s!1!Up!AppDial!(Outgoing Line)!61993787159!1!1!3!480!1e8a2b6a-73a4-4d10-bc66-b0b488f51030!1744055463.1127548\n', 'SIP/IP-188-R33In-0006011d!macro-interno!s!1!Up!AppDial!(Outgoing Line)!188!2!2!3!1733012!769f94ac-cf5a-4976-a7c5-843d74550915!1742322931.820954\n', 'SIP/388-IPoGO3b-0006b817!macro-interno!s!1!Up!AppDial!(Outgoing Line)!388!2!2!3!1145592!9aca9798-df9e-44b3-9302-eecd0203e08e!1742910351.916489\n', 'SIP/551120872200-00086210!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!75982621608!2!!3!687!!1744055256.1127112\n', 'SIP/551120872200-00086224!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!88993257197!1!!3!657!56b9788e-f0ed-48e2-b2da-d3ebffc62fd3!1744055286.1127137\n', 'SIP/20872200-0006f0d3!macro-externa!s!1!Up!AppDial!(Outgoing Line)!015997538757!3!3!3!1044794!117cd628-ad7d-4598-9dfb-b9e9be00b40f!1743011148.944923\n', 'SIP/394-IPDoQmZ-0008630b!macro-externa!s!22!Up!Dial!SIP/20872200/061993787159,90,TtM(saida_atendimento)!394!1!1!3!480!1e8a2b6a-73a4-4d10-bc66-b0b488f51030!1744055462.1127547\n', 'SIP/551120872200-0008654a!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!63999140501!1!!3!80!!1744055862.1128538\n', 'SIP/IP-102-1FZHj-00081bc6!macro-interno!s!30!Up!Dial!SIP/IP-167-FRpMQ,25,TtM(ramal_atendimento)!102!2!2!3!27947!613a1f50-9ae8-41a2-b643-e74ed3719403!1744027996.1092437\n', 'Local/79999095695@C_2_SAIDA-00006336;1!C_2_SAIDA!!1!Up!AppDial!(Outgoing Line)!379!2!2!3!1145532!aeb165a6-5b63-4b8a-b7f2-1c0cdd887b13!1742910411.916528\n', 'Local/79999095695@C_2_SAIDA-00006336;2!macro-externa!s!22!Up!Dial!SIP/20872200/079999095695,90,TtM(saida_atendimento)!379!1!2!3!1145532!5fc36acb-7134-4d6b-9722-50579affefb1!1742910411.916529\n', 'SIP/551120872200-00086596!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!74981516558!1!!3!41!!1744055901.1128712\n', 'SIP/20872200-0006b60b!macro-filas!s!13!Up!Queue!Queue_238,tk,,,,,agente_atendimento!5532987075444!1!!3!1146769!a6eaf981-7ba7-438d-9e5e-36ae7012c46b!1742909173.915578\n', 'SIP/IP-176-Jf1ll-0006f0d2!macro-externa!s!22!Up!Dial!SIP/20872200/015997538757,90,TtM(saida_atendimento)!176!3!3!3!1044794!117cd628-ad7d-4598-9dfb-b9e9be00b40f!1743011148.944922\n', 'SIP/551120872200-000865ca!URA_1!Menu1!9!Up!BackGround!/var/lib/asterisk/sounds/audios/sisbralphaprincipal_yxsW8Jx!77981145244!!!3!18!!1744055925.1128764\n', 'SIP/551120872200-0008659c!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!99991417420!1!!3!40!!1744055903.1128718\n', 'SIP/551120872200-000862e1!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!19974132300!2!!3!511!!1744055431.1127431\n', 'SIP/134-IPF8nR3-000864dd!CONTEXT_2!Menu1!1!Up!AppQueue!(Outgoing Line)!134!!1!3!194!fafc1c66-83bd-4af0-a14e-35c06098cad6!1744055749.1128356\n', 'SIP/IP-167-FRpMQ-00081bc7!macro-interno!s!1!Up!AppDial!(Outgoing Line)!167!2!2!3!27947!613a1f50-9ae8-41a2-b643-e74ed3719403!1744027996.1092438\n', 'SIP/20872200-0006f12b!macro-externa!s!1!Up!AppDial!(Outgoing Line)!81994351954!2!1!3!1044157!34780745-dd6d-4f01-95c7-bd80c88f4dc9!1743011785.945165\n', 'SIP/262-IPJM3GO-0006f054!macro-externa!s!22!Up!Dial!SIP/20872200/071987201018,90,TtM(saida_atendimento)!262!3!3!3!1045236!73272644-562e-4f30-b0c6-d6f6bc15321f!1743010707.944758\n', 'SIP/130-IP56Zpb-00081407!CONTEXT_2!!1!Up!ChanSpy!SIP/136-IP8IaBB,bq!130!!!3!264290!!1743791653.1088618\n', 'SIP/551120872200-000862ed!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!86999334228!2!!3!507!!1744055436.1127443\n', 'SIP/551120872200-000862ff!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!21972608067!2!!3!491!!1744055451.1127535\n', 'SIP/20872200-000600aa!macro-externa!s!1!Up!AppDial!(Outgoing Line)!42991593242!2!3!3!1733211!aa653bb4-f1d4-4fe6-ac6f-1b211e02cce4!1742322731.820652\n', 'SIP/158-0006b813!macro-interno!s!1!Up!AppDial!(Outgoing Line)!158!2!2!3!1145624!0741df32-0193-4d1a-b262-6477c601ea17!1742910319.916477\n', 'SIP/137-IPM87rR-00086526!CONTEXT_2!Menu1!1!Up!AppQueue!(Outgoing Line)!137!!1!3!102!b28f4938-c3a0-4741-a13d-20027a7f301b!1744055840.1128502\n', 'SIP/20872200-0008644e!macro-filas!s!13!Up!Queue!Queue_238,tk,,,,,agente_atendimento!5571981867699!1!!3!294!!1744055648.1128134\n', 'SIP/551120872200-00086344!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!71993369850!2!!3!440!!1744055503.1127651\n', 'SIP/403-IPuNdIC-000600a9!macro-interno!s!1!Up!AppDial!(Outgoing Line)!403!2!2!3!1733212!40cb4a57-9716-433d-a16e-81d20ee353ab!1742322731.820649\n', 'SIP/551120872200-0008633a!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!37999874281!2!!3!445!!1744055498.1127641\n', 'SIP/20872200-0005ffa3!macro-interno!s!30!Up!Dial!SIP/IP-188-R33In,25,TtM(ramal_atendimento)!5511945964908!2!2!3!1733985!769f94ac-cf5a-4976-a7c5-843d74550915!1742321958.820144\n', 'SIP/20872200-00085c41!macro-externa!s!1!Up!AppDial!(Outgoing Line)!015981305687!3!3!3!1750!6c1e181f-2532-4803-8aca-d7492477d372!1744054193.1123751\n', 'SIP/379-IPL8D33-0006b81f!macro-interno!s!1!Up!AppDial!(Outgoing Line)!379!2!2!3!1145532!aeb165a6-5b63-4b8a-b7f2-1c0cdd887b13!1742910410.916527\n', 'SIP/308-IPBA0xb-0006b82d!macro-externa!s!22!Up!Dial!SIP/20872200/071991869910,90,TtM(saida_atendimento)!308!3!3!3!1145449!4e843037-768d-4509-8115-86e617cdf1a4!1742910493.916554\n', 'SIP/551120872200-00085e58!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!13974137542!2!!3!1306!!1744054637.1125049\n', 'Local/81994351954@C_2_SAIDA-0000649a;2!macro-externa!s!22!Up!Dial!SIP/20872200/081994351954,90,TtM(saida_atendimento)!287!1!2!3!1044157!34780745-dd6d-4f01-95c7-bd80c88f4dc9!1743011785.945164\n', 'Local/81994351954@C_2_SAIDA-0000649a;1!C_2_SAIDA!!1!Up!AppDial!(Outgoing Line)!287!2!2!3!1044157!c132c264-c739-4125-91d2-8a8177bf8c89!1743011785.945163\n', 'SIP/551120872200-000860c8!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!Anonymous!2!!3!962!!1744054980.1126090\n', 'SIP/136-IP8IaBB-000837d4!macro-eventos_fim_chamada!s!12!Up!Hangup!!136!1!1!3!12102!!1744043841.1106326\n', 'SIP/551120872200-0008605e!macro-filas!s!13!Up!Queue!Queue_291,tk,,,,,agente_atendimento!13988129066!2!!3!1015!!1744054928.1125808\n', 'SIP/5435204040-00086508!macro-filas!s!13!Up!Queue!Queue_110,tk,,,180,,agente_atendimento!98991294991!1!!3!126!!1744055816.1128468\n', 'SIP/20872200-00060195!macro-externa!s!1!Up!AppDial!(Outgoing Line)!01832227047!3!3!3!1732898!f836645e-f930-48ee-bf44-8c24e932f68b!1742323045.821157\n', 'SIP/287-IPcdhrw-0006f12a!macro-interno!s!1!Up!AppDial!(Outgoing Line)!287!2!2!3!1044158!c132c264-c739-4125-91d2-8a8177bf8c89!1743011785.945162\n', 'Local/42991593242@C_4_SAIDA-00005b70;1!C_4_SAIDA!!1!Up!AppDial!(Outgoing Line)!403!2!2!3!1733211!40cb4a57-9716-433d-a16e-81d20ee353ab!1742322731.820650\n', 'Local/42991593242@C_4_SAIDA-00005b70;2!macro-externa!s!22!Up!Dial!SIP/20872200/042991593242,90,TtM(saida_atendimento)!403!3!2!3!1733211!aa653bb4-f1d4-4fe6-ac6f-1b211e02cce4!1742322731.820651\n', 'SIP/280-IP0pOQg-0006b661!CONTEXT_2!558007291979!1!Up!AppQueue!(Outgoing Line)!280!!1!3!1146537!a6eaf981-7ba7-438d-9e5e-36ae7012c46b!1742909406.915694\n', 'SIP/288-IP7O0T2-00060194!macro-externa!s!22!Up!Dial!SIP/20872200/01832227047,90,TtM(saida_atendimento)!288!3!3!3!1732898!f836645e-f930-48ee-bf44-8c24e932f68b!1742323045.821156\n', 'SIP/20872200-00086572!macro-filas!s!13!Up!Queue!Queue_238,tk,,,,,agente_atendimento!5563992250132!1!!3!59!!1744055884.1128651\n', 'SIP/20872200-0006b818!macro-externa!s!1!Up!AppDial!(Outgoing Line)!11992570001!2!1!3!1145590!5074d955-3a61-47a6-b056-264cbb0b70c2!1742910352.916492\n', 'SIP/20872200-0006b820!macro-externa!s!1!Up!AppDial!(Outgoing Line)!79999095695!2!1!3!1145532!5fc36acb-7134-4d6b-9722-50579affefb1!1742910411.916530\n', '--END COMMAND--\r\n']
        expected_data = [{'channel': 'SIP/551120872200-00085b93', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '77988367483', 'uniqueid': '1744054071.1123499'}, {'channel': 'SIP/262-IPJM3GO-00085c40', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/015981305687,90,TtM(saida_atendimento)', 'callerid_num': '262', 'uniqueid': '1744054193.1123750'}, {'channel': 'SIP/20872200-0006b82e', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '071991869910', 'uniqueid': '1742910494.916555'}, {'channel': 'SIP/551120872200-00086494', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '17996724635', 'uniqueid': '1744055691.1128248'}, {'channel': 'SIP/551120872200-000864e5', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '75998589575', 'uniqueid': '1744055773.1128431'}, {'channel': 'Local/11992570001@C_2_SAIDA-00006334;1', 'context': 'C_2_SAIDA', 'exten': '', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '388', 'uniqueid': '1742910352.916490'}, {'channel': 'Local/11992570001@C_2_SAIDA-00006334;2', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/992570001,90,TtM(saida_atendimento)', 'callerid_num': '388', 'uniqueid': '1742910352.916491'}, {'channel': 'SIP/136-IP8IaBB-000862f8', 'context': 'CONTEXT_2', 'exten': 'Menu1_op1', 'priority': '1', 'state': 'Up', 'application': 'AppQueue', 'app_data': '(Outgoing Line)', 'callerid_num': '136', 'uniqueid': '1744055447.1127504'}, {'channel': 'SIP/551120872200-000864df', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '71996233050', 'uniqueid': '1744055753.1128403'}, {'channel': 'SIP/551120872200-00086527', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '16988115021', 'uniqueid': '1744055841.1128503'}, {'channel': 'SIP/551120872200-0006b7af', 'context': 'macro-interno', 'exten': 's', 'priority': '30', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/158,25,TtM(ramal_atendimento)', 'callerid_num': '88993826922', 'uniqueid': '1742909998.916169'}, {'channel': 'SIP/20872200-0006f055', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '071987201018', 'uniqueid': '1743010707.944759'}, {'channel': 'SIP/551120872200-00085cc2', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '69999771487', 'uniqueid': '1744054279.1123989'}, {'channel': 'SIP/20872200-0008630c', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '61993787159', 'uniqueid': '1744055463.1127548'}, {'channel': 'SIP/IP-188-R33In-0006011d', 'context': 'macro-interno', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '188', 'uniqueid': '1742322931.820954'}, {'channel': 'SIP/388-IPoGO3b-0006b817', 'context': 'macro-interno', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '388', 'uniqueid': '1742910351.916489'}, {'channel': 'SIP/551120872200-00086210', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '75982621608', 'uniqueid': '1744055256.1127112'}, {'channel': 'SIP/551120872200-00086224', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '88993257197', 'uniqueid': '1744055286.1127137'}, {'channel': 'SIP/20872200-0006f0d3', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '015997538757', 'uniqueid': '1743011148.944923'}, {'channel': 'SIP/394-IPDoQmZ-0008630b', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/061993787159,90,TtM(saida_atendimento)', 'callerid_num': '394', 'uniqueid': '1744055462.1127547'}, {'channel': 'SIP/551120872200-0008654a', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '63999140501', 'uniqueid': '1744055862.1128538'}, {'channel': 'SIP/IP-102-1FZHj-00081bc6', 'context': 'macro-interno', 'exten': 's', 'priority': '30', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/IP-167-FRpMQ,25,TtM(ramal_atendimento)', 'callerid_num': '102', 'uniqueid': '1744027996.1092437'}, {'channel': 'Local/79999095695@C_2_SAIDA-00006336;1', 'context': 'C_2_SAIDA', 'exten': '', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '379', 'uniqueid': '1742910411.916528'}, {'channel': 'Local/79999095695@C_2_SAIDA-00006336;2', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/079999095695,90,TtM(saida_atendimento)', 'callerid_num': '379', 'uniqueid': '1742910411.916529'}, {'channel': 'SIP/551120872200-00086596', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '74981516558', 'uniqueid': '1744055901.1128712'}, {'channel': 'SIP/20872200-0006b60b', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_238,tk,,,,,agente_atendimento', 'callerid_num': '5532987075444', 'uniqueid': '1742909173.915578'}, {'channel': 'SIP/IP-176-Jf1ll-0006f0d2', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/015997538757,90,TtM(saida_atendimento)', 'callerid_num': '176', 'uniqueid': '1743011148.944922'}, {'channel': 'SIP/551120872200-000865ca', 'context': 'URA_1', 'exten': 'Menu1', 'priority': '9', 'state': 'Up', 'application': 'BackGround', 'app_data': '/var/lib/asterisk/sounds/audios/sisbralphaprincipal_yxsW8Jx', 'callerid_num': '77981145244', 'uniqueid': '1744055925.1128764'}, {'channel': 'SIP/551120872200-0008659c', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '99991417420', 'uniqueid': '1744055903.1128718'}, {'channel': 'SIP/551120872200-000862e1', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '19974132300', 'uniqueid': '1744055431.1127431'}, {'channel': 'SIP/134-IPF8nR3-000864dd', 'context': 'CONTEXT_2', 'exten': 'Menu1', 'priority': '1', 'state': 'Up', 'application': 'AppQueue', 'app_data': '(Outgoing Line)', 'callerid_num': '134', 'uniqueid': '1744055749.1128356'}, {'channel': 'SIP/IP-167-FRpMQ-00081bc7', 'context': 'macro-interno', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '167', 'uniqueid': '1744027996.1092438'}, {'channel': 'SIP/20872200-0006f12b', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '81994351954', 'uniqueid': '1743011785.945165'}, {'channel': 'SIP/262-IPJM3GO-0006f054', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/071987201018,90,TtM(saida_atendimento)', 'callerid_num': '262', 'uniqueid': '1743010707.944758'}, {'channel': 'SIP/130-IP56Zpb-00081407', 'context': 'CONTEXT_2', 'exten': '', 'priority': '1', 'state': 'Up', 'application': 'ChanSpy', 'app_data': 'SIP/136-IP8IaBB,bq', 'callerid_num': '130', 'uniqueid': '1743791653.1088618'}, {'channel': 'SIP/551120872200-000862ed', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '86999334228', 'uniqueid': '1744055436.1127443'}, {'channel': 'SIP/551120872200-000862ff', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '21972608067', 'uniqueid': '1744055451.1127535'}, {'channel': 'SIP/20872200-000600aa', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '42991593242', 'uniqueid': '1742322731.820652'}, {'channel': 'SIP/158-0006b813', 'context': 'macro-interno', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '158', 'uniqueid': '1742910319.916477'}, {'channel': 'SIP/137-IPM87rR-00086526', 'context': 'CONTEXT_2', 'exten': 'Menu1', 'priority': '1', 'state': 'Up', 'application': 'AppQueue', 'app_data': '(Outgoing Line)', 'callerid_num': '137', 'uniqueid': '1744055840.1128502'}, {'channel': 'SIP/20872200-0008644e', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_238,tk,,,,,agente_atendimento', 'callerid_num': '5571981867699', 'uniqueid': '1744055648.1128134'}, {'channel': 'SIP/551120872200-00086344', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '71993369850', 'uniqueid': '1744055503.1127651'}, {'channel': 'SIP/403-IPuNdIC-000600a9', 'context': 'macro-interno', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '403', 'uniqueid': '1742322731.820649'}, {'channel': 'SIP/551120872200-0008633a', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '37999874281', 'uniqueid': '1744055498.1127641'}, {'channel': 'SIP/20872200-0005ffa3', 'context': 'macro-interno', 'exten': 's', 'priority': '30', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/IP-188-R33In,25,TtM(ramal_atendimento)', 'callerid_num': '5511945964908', 'uniqueid': '1742321958.820144'}, {'channel': 'SIP/20872200-00085c41', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '015981305687', 'uniqueid': '1744054193.1123751'}, {'channel': 'SIP/379-IPL8D33-0006b81f', 'context': 'macro-interno', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '379', 'uniqueid': '1742910410.916527'}, {'channel': 'SIP/308-IPBA0xb-0006b82d', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/071991869910,90,TtM(saida_atendimento)', 'callerid_num': '308', 'uniqueid': '1742910493.916554'}, {'channel': 'SIP/551120872200-00085e58', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '13974137542', 'uniqueid': '1744054637.1125049'}, {'channel': 'Local/81994351954@C_2_SAIDA-0000649a;2', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/081994351954,90,TtM(saida_atendimento)', 'callerid_num': '287', 'uniqueid': '1743011785.945164'}, {'channel': 'Local/81994351954@C_2_SAIDA-0000649a;1', 'context': 'C_2_SAIDA', 'exten': '', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '287', 'uniqueid': '1743011785.945163'}, {'channel': 'SIP/551120872200-000860c8', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': 'Anonymous', 'uniqueid': '1744054980.1126090'}, {'channel': 'SIP/136-IP8IaBB-000837d4', 'context': 'macro-eventos_fim_chamada', 'exten': 's', 'priority': '12', 'state': 'Up', 'application': 'Hangup', 'app_data': '', 'callerid_num': '136', 'uniqueid': '1744043841.1106326'}, {'channel': 'SIP/551120872200-0008605e', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_291,tk,,,,,agente_atendimento', 'callerid_num': '13988129066', 'uniqueid': '1744054928.1125808'}, {'channel': 'SIP/5435204040-00086508', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_110,tk,,,180,,agente_atendimento', 'callerid_num': '98991294991', 'uniqueid': '1744055816.1128468'}, {'channel': 'SIP/20872200-00060195', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '01832227047', 'uniqueid': '1742323045.821157'}, {'channel': 'SIP/287-IPcdhrw-0006f12a', 'context': 'macro-interno', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '287', 'uniqueid': '1743011785.945162'}, {'channel': 'Local/42991593242@C_4_SAIDA-00005b70;1', 'context': 'C_4_SAIDA', 'exten': '', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '403', 'uniqueid': '1742322731.820650'}, {'channel': 'Local/42991593242@C_4_SAIDA-00005b70;2', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/042991593242,90,TtM(saida_atendimento)', 'callerid_num': '403', 'uniqueid': '1742322731.820651'}, {'channel': 'SIP/280-IP0pOQg-0006b661', 'context': 'CONTEXT_2', 'exten': '558007291979', 'priority': '1', 'state': 'Up', 'application': 'AppQueue', 'app_data': '(Outgoing Line)', 'callerid_num': '280', 'uniqueid': '1742909406.915694'}, {'channel': 'SIP/288-IP7O0T2-00060194', 'context': 'macro-externa', 'exten': 's', 'priority': '22', 'state': 'Up', 'application': 'Dial', 'app_data': 'SIP/20872200/01832227047,90,TtM(saida_atendimento)', 'callerid_num': '288', 'uniqueid': '1742323045.821156'}, {'channel': 'SIP/20872200-00086572', 'context': 'macro-filas', 'exten': 's', 'priority': '13', 'state': 'Up', 'application': 'Queue', 'app_data': 'Queue_238,tk,,,,,agente_atendimento', 'callerid_num': '5563992250132', 'uniqueid': '1744055884.1128651'}, {'channel': 'SIP/20872200-0006b818', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '11992570001', 'uniqueid': '1742910352.916492'}, {'channel': 'SIP/20872200-0006b820', 'context': 'macro-externa', 'exten': 's', 'priority': '1', 'state': 'Up', 'application': 'AppDial', 'app_data': '(Outgoing Line)', 'callerid_num': '79999095695', 'uniqueid': '1742910411.916530'}]
        parser = ChannelParser()
        data = parser.get_data(received_data)
        self.assertListEqual(data, expected_data)
    
    def test_get_data_empty(self):
        received_data = ['Response: Success\r\n', 'ActionID: tatianno-ThinkPad-L470-0000000c\r\n', 'Message: Command output follows\r\n', 'Output: \r\n']
        expected_data = []
        parser = ChannelParser()
        data = parser.get_data(received_data)
        self.assertListEqual(data, expected_data)

    def test_get_parser_channel(self):
        received_data = 'Output: SIP/IP-7436-QPQGE-00000002!C_1_ENT!997799298!1!Down!AppDial!(Outgoing Line)!997799298!3!3!3!2!!1740760337.2\r\n'
        expected_data = {
            'channel': 'SIP/IP-7436-QPQGE-00000002',
            'context': 'C_1_ENT',
            'exten': '997799298',
            'priority': '1',
            'state': 'Down',
            'application': 'AppDial',
            'app_data': '(Outgoing Line)',
            'callerid_num': '997799298',
            'uniqueid': '1740760337.2'
        }
        parser = ChannelParser()
        data = parser._get_parser_channel(received_data)
        self.assertEqual(data, expected_data)

    def test_get_parse_channel_invalid_data(self):
        received_data = 'Response: Success\r\n'
        expected_data = None
        parser = ChannelParser()
        data = parser._get_parser_channel(received_data)
        self.assertEqual(data, expected_data)

    def test_get_channel(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = 'SIP/IP-7436-QPQGE-00000002'
        parser = ChannelParser()
        channel = parser._get_channel(received_data)
        self.assertEqual(channel, expected_data)
    
    def test_get_context(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = 'C_1_ENT'
        parser = ChannelParser()
        context = parser._get_context(received_data)
        self.assertEqual(context, expected_data)
    
    def test_get_exten(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = '997799298'
        parser = ChannelParser()
        exten = parser._get_exten(received_data)
        self.assertEqual(exten, expected_data)
    
    def test_get_priority(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = '1'
        parser = ChannelParser()
        priority = parser._get_priority(received_data)
        self.assertEqual(priority, expected_data)
    
    def test_get_state(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = 'Down'
        parser = ChannelParser()
        state = parser._get_state(received_data)
        self.assertEqual(state, expected_data)
    
    def test_get_application(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = 'AppDial'
        parser = ChannelParser()
        application = parser._get_application(received_data)
        self.assertEqual(application, expected_data)
    
    def test_get_app_data(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = '(Outgoing Line)'
        parser = ChannelParser()
        app_data = parser._get_app_data(received_data)
        self.assertEqual(app_data, expected_data)
    
    def test_get_callerid_num(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = '997799298'
        parser = ChannelParser()
        callerid_num = parser._get_callerid_num(received_data)
        self.assertEqual(callerid_num, expected_data)
    
    def test_get_uniqueid(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = '1740760337.2'
        parser = ChannelParser()
        callerid_num = parser._get_uniqueid(received_data)
        self.assertEqual(callerid_num, expected_data)
    
    def test_get_uniqueid_raise_except_index_error(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298']
        expected_data = None
        parser = ChannelParser()
        callerid_num = parser._get_uniqueid(received_data)
        self.assertEqual(callerid_num, expected_data)
    
    def test_get_data_list(self):
        received_data = 'Output: SIP/IP-7436-QPQGE-00000002!C_1_ENT!997799298!1!Down!AppDial!(Outgoing Line)!997799298!3!3!3!2!!1740760337.2\r\n'
        expected_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        parser = ChannelParser()
        data_list = parser._get_data_list(received_data)
        self.assertListEqual(data_list, expected_data)
    
    def test_clean_data(self):
        received_data = 'Output: SIP/IP-7436-QPQGE-00000002!C_1_ENT!997799298!1!Down!AppDial!(Outgoing Line)!997799298!3!3!3!2!!1740760337.2\r\n'
        expected_data = 'SIP/IP-7436-QPQGE-00000002!C_1_ENT!997799298!1!Down!AppDial!(Outgoing Line)!997799298!3!3!3!2!!1740760337.2'
        parser = ChannelParser()
        data = parser._clean_data(received_data)
        self.assertEqual(data, expected_data)
    
    def test_get_value_in_list(self):
        received_data = ['SIP/IP-7436-QPQGE-00000002','C_1_ENT','997799298','1','Down','AppDial','(Outgoing Line)','997799298','3','3','3','2','','1740760337.2']
        expected_data = 'Down'
        parser = ChannelParser()
        data = parser._get_value_in_list(received_data, 4)
        self.assertEqual(data, expected_data)
        expected_data = None
        data = parser._get_value_in_list(received_data, 15)
        self.assertEqual(data, expected_data)
        